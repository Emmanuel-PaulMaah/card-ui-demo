<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Friend Cards</title>
<style>
  :root{
    --card-w: clamp(280px, 92vw, 420px);
    --radius: 16px;
    --shadow: 0 10px 30px rgba(0,0,0,.15);

    --tx: 0px; --ty: 0px; --rz: 0deg; --ry: 0deg;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100dvh;display:grid;place-items:center;background:#f6f7fb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{width:min(96vw,560px);padding:10px}

  .stage{width:var(--card-w);aspect-ratio:320/460;margin:auto;perspective:1200px;position:relative}

  .card{
    position:absolute;inset:0;border-radius:var(--radius);box-shadow:var(--shadow);
    transform-style:preserve-3d;
    transform: translate(var(--tx), var(--ty)) rotate(var(--rz)) rotateY(var(--ry));
    transition: transform .28s cubic-bezier(.25,.7,.3,1);
    touch-action:none;background:#000;overflow:hidden;isolation:isolate;will-change:transform;
  }
  .card.dim::after{
    content:"";position:absolute;inset:0;pointer-events:none;background:rgba(0,0,0,.28);
  }
  .side{position:absolute;inset:0;border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column;backface-visibility:hidden;-webkit-backface-visibility:hidden}

  /* FRONT (full-bleed image) */
  .front{color:#fff;display:flex;flex-direction:column;justify-content:flex-end}
  .bg{
    position:absolute; inset:0; z-index:-1;
    background-color:#111;
    background-repeat:no-repeat;
    background-size:cover;
    background-position:center center;      /* CHANGED: hard center */
    transform:scale(1.02)
  }
  .front::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.04) 20%,rgba(0,0,0,.45) 75%)}
  .header{position:absolute;left:0;right:0;top:0;display:flex;align-items:center;justify-content:space-between;padding:14px 16px}
  .name{font-weight:700;font-size:clamp(16px,3.8vw,20px);padding:6px 10px;border-radius:10px;background:rgba(238,242,255,.9);color:#3730a3;backdrop-filter:blur(6px)}
  .gem{display:inline-flex;align-items:center;gap:6px;background:rgba(236,254,255,.92);color:#155e75;padding:6px 10px;border-radius:12px;font-weight:700;font-size:clamp(13px,3.5vw,15px)}
  .gem::before{content:"♦"}

  /* BACK (info) */
  .back{background:#0c111b;color:#e5e7eb;transform:rotateY(180deg);padding:14px;gap:12px}
  .row{display:flex;justify-content:space-between;align-items:center;background:#111827;padding:12px 14px;border-radius:12px}
  .row+.row{margin-top:10px}
  /* CHANGED: dedicated bio block for reliable rendering */
  .bioBlock{
    background:#111827; border-radius:12px; padding:14px;
  }
  .bioLabel{opacity:.7; font-size:13px; display:block; margin-bottom:6px;}
  .bioText{font-size:15px; line-height:1.5; text-align:center; word-break:break-word; white-space:normal;}

  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:#22c55e;color:#fff;font-weight:700;cursor:pointer}
  .nav{display:flex;justify-content:space-between;gap:8px;margin-top:14px}
  .nav button{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0b1320;color:#e5e7eb;cursor:pointer;font-weight:600}
  .nav button.btn{border:0;background:#22c55e;color:#fff}

  /* cross-fade of faces */
  .faceFade{transition:opacity .2s ease}
  .front.faceFade{opacity:1}
  .back.faceFade{opacity:0}
  .card.backface .front.faceFade{opacity:0}
  .card.backface .back.faceFade{opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <div class="stage">
    <div class="card" id="card">
      <!-- FRONT -->
      <div class="side front faceFade">
        <div class="bg" id="bg"></div>
        <div class="header">
          <div class="name" id="name">name</div>
          <div class="gem" id="gems">0</div>
        </div>
      </div>

      <!-- BACK -->
      <div class="side back faceFade">
        <div class="row"><span>username</span> <strong id="username">@handle</strong></div>

        <!-- CHANGED: replace the old span#bio row with a block that always shows -->
        <div class="bioBlock">
          <span class="bioLabel">bio</span>
          <div class="bioText" id="bio">—</div>
        </div>

        <div class="row"><span>phone</span> <strong id="phone">—</strong></div>
        <div class="nav">
          <button id="flipBack">flip</button>
          <button id="callBtn" class="btn">call</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // images live at ./images/
  const IMG_VER = 'v=1';

  const friends = [
    {
      name: "elon musk",
      gems: 99,
      avatar: `images/elon-musk.webp?${IMG_VER}`,
      username: "@elonmusk",
      bio: "emperor kekius maximus, gorklon rust",
      phone: "",
      focusY: 45  // CHANGED: optional focal point (% from top); centers face better
    },
    {
      name: "kendrick lamar",
      gems: 77,
      avatar: `images/kendrick-lamar.webp?${IMG_VER}`,
      username: "@kendricklamar",
      bio: "oklama",
      phone: "",
      focusY: 40
    },
    {
      name: "emmanuel",
      gems: 12,
      avatar: `images/emmanuel-paulmaah.jpg?${IMG_VER}`,
      username: "@emmanuel",
      bio: "aspiring polymath",
      phone: "",
      focusY: 42
    },
  ];

  const els = {
    card: document.getElementById('card'),
    bg: document.getElementById('bg'),
    name: document.getElementById('name'),
    gems: document.getElementById('gems'),
    username: document.getElementById('username'),
    bio: document.getElementById('bio'),
    phone: document.getElementById('phone'),
    flipBack: document.getElementById('flipBack'),
    callBtn: document.getElementById('callBtn'),
  };

  let i = 0;
  let showingBack = false;
  let flipping = false;
  let ryDeg = 0;

  let longPressTimer = null;
  let longPressed = false;
  const LONG_MS = 520;
  const TAP_MOVE_CANCEL = 10;

  const setVars = (tx=0,ty=0,rz=0,ry=ryDeg)=>{
    els.card.style.setProperty('--tx', tx+'px');
    els.card.style.setProperty('--ty', ty+'px');
    els.card.style.setProperty('--rz', rz+'deg');
    els.card.style.setProperty('--ry', ry+'deg');
  };

  function render(idx){
    const f = friends[idx];
    els.name.textContent = f.name;
    els.gems.textContent = f.gems;

    // CHANGED: force center and apply optional per-person focus
    const focusY = (typeof f.focusY === 'number') ? f.focusY : 50;
    els.bg.style.backgroundImage = `url("${f.avatar}")`;
    els.bg.style.backgroundPosition = `center ${focusY}%`;

    els.username.textContent = f.username || '—';
    els.bio.textContent = f.bio || '—';
    els.phone.textContent = f.phone || '—';

    // reset to front
    showingBack = false; ryDeg = 0;
    setVars(0,0,0,ryDeg);
    els.card.classList.remove('backface','dim');
  }

  function callFriend(){
    const phone = friends[i]?.phone;
    if (!phone) { alert("no phone on file."); return; }
    window.location.href = `tel:${phone.replace(/\s+/g,'')}`;
  }

  function next(dir=1){
    i = (i + dir + friends.length) % friends.length;
    render(i);
  }

  function preloadImages(){
    friends.forEach(f=>{ const img = new Image(); img.src = f.avatar; });
  }

  function flipOnce(){
    if (flipping) return;
    flipping = true;

    const start = ryDeg;
    const end = ryDeg + 180;

    showingBack = !showingBack;
    els.card.classList.toggle('backface', showingBack);
    els.card.classList.toggle('dim', showingBack);

    const anim = els.card.animate(
      [
        { transform: `translate(var(--tx), var(--ty)) rotate(var(--rz)) rotateY(${start}deg)` },
        { transform: `translate(var(--tx), var(--ty)) rotate(var(--rz)) rotateY(${end}deg)` }
      ],
      { duration: 240, easing: 'cubic-bezier(.25,.7,.3,1)', fill:'both' }
    );
    anim.onfinish = ()=>{ ryDeg = end % 360; setVars(0,0,0,ryDeg); flipping = false; };
    anim.oncancel  = ()=>{ flipping = false; };
  }

  // gestures
  let dragging=false, startX=0, startY=0, curX=0, curY=0;
  const SWIPE_X=90, SWIPE_Y=100, ROTATE_FACTOR=18, LIM_X=140, LIM_Y=120;

  function setDrag(dx,dy){
    const cx = Math.max(-LIM_X, Math.min(LIM_X, dx));
    const cy = Math.max(-LIM_Y, Math.min(LIM_Y, dy));
    const rz = (cx/LIM_X)*ROTATE_FACTOR;
    els.card.style.transition='none';
    setVars(cx,cy,rz,ryDeg);
  }
  function resetDrag(){
    els.card.style.transition='transform .22s cubic-bezier(.25,.7,.3,1)';
    setVars(0,0,0,ryDeg);
  }
  function flingHorizontal(dir){
    els.card.style.transition='transform .2s ease-out';
    els.card.style.transform = `translate(${dir*420}px,0) rotate(${dir*30}deg) rotateY(${ryDeg}deg)`;
    setTimeout(()=>{ next(dir); els.card.style.transition=''; els.card.style.transform=''; }, 180);
  }
  function flingUp(){
    els.card.style.transition='transform .2s ease-out';
    els.card.style.transform = `translate(0,-480px) rotate(-6deg) rotateY(${ryDeg}deg)`;
    setTimeout(()=>{ next(1); els.card.style.transition=''; els.card.style.transform=''; }, 180);
  }

  // pointer + long-press for call
  els.card.addEventListener('pointerdown', e=>{
    if (flipping) return;
    dragging=true; startX=e.clientX; startY=e.clientY; curX=startX; curY=startY;
    longPressed = false;

    clearTimeout(longPressTimer);
    longPressTimer = setTimeout(()=>{
      longPressed = true;
      els.card.classList.add('dim');
      setTimeout(()=>{ if(!showingBack) els.card.classList.remove('dim'); }, 120);
      callFriend();
    }, LONG_MS);

    els.card.setPointerCapture(e.pointerId);
  });

  els.card.addEventListener('pointermove', e=>{
    if(!dragging || flipping) return;
    curX=e.clientX; curY=e.clientY;
    const moved = Math.hypot(curX-startX, curY-startY);
    if (moved > 10) clearTimeout(longPressTimer);
    setDrag(curX-startX, curY-startY);
  });

  els.card.addEventListener('pointerup', e=>{
    if(!dragging) return; dragging=false; els.card.releasePointerCapture(e.pointerId);
    clearTimeout(longPressTimer);

    const dx=curX-startX, dy=curY-startY;

    if (longPressed) { resetDrag(); return; }
    if (-dy>SWIPE_Y){ flingUp(); return; }
    if (Math.abs(dx)>SWIPE_X){ flingHorizontal(dx<0?-1:1); return; }

    resetDrag();
    if (Math.hypot(dx,dy) <= 10) flipOnce(); // tap
  });

  // buttons on back
  els.flipBack.addEventListener('click', flipOnce);
  els.callBtn.addEventListener('click', callFriend);

  // keyboard
  window.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') next(1);
    if(e.key==='ArrowLeft') next(-1);
    if(e.key===' ') { e.preventDefault(); flipOnce(); }
    if(e.key.toLowerCase()==='u') flingUp();
  });

  preloadImages();
  render(i);
</script>
</body>
</html>
